\chapter{Solución del problema}
\thispagestyle{empty} % Quitar el número

En este capítulo se expresan las técnicas utilizadas por el pasante para el cumplimiento de las funcionalidades expresadas en el capítulo anterior.

El lenguaje de programación usado como base para el Sistema de Gestión de Aprendizaje (SGA) de Fischer, Knochblauch \& CO (FKC) es PHP. La mayor parte del código escrito por el pasante para la solución es por lo tanto escrita en este lenguaje.

El trabajo se dividió en módulos. Se analizaron sus dependencias con el fin de crear un plan de trabajo organizado, que permitiera además la entrega constante de software funcional, apegandose al marco de trabajo iterativo.

AQUI SERIA BUENO UNA INTRODUCCION CON CUANTOS MODULOS SE VAN A DESCRIBIR LUEGO PERO LA METO AL FINAL PORQUE NO ESTOY MUY CLARO CUAL SERÍA UNA CLARA DIVISIÓN.

	\section{Ubicaciones} % (fold)
	\label{sec:ubicaciones}
	
	Para soportar esta funcionalidad en la base de datos se creó una tabla llamada ubicación con los datos que parecieron relevantes para el cliente, ilustrada en el anexo \ref{fig:baseDeDatosFinal}. Dicha ubicación estaría relacionada con las sesiones, pudiendo una ubicación alojar distintas sesiones. El SGA permite mantener distintos clientes para dar soporte de grandes compañías con filiales, por lo que las ubicaciones se construyen aisladas del grueso de la funcionalidad (los seminarios) para poder ser usadas luego en funcionalidades futuras o integrada en sistemas de los clientes activos de SGAs de FKC. Tienen una relación directa con la tabla cliente a través de una llave foránea. Para la clave primaria se usó un identificador creciente autogenerado.

	Se acordó que el manejo de las ubicaciones se llevara a cabo en el área de administración de la aplicación, por el usuario administrador. Se agrego una nueva entrada de manejo de ubicaciones en la interfaz del administrador con este fin.

	Se logró conseguir un producto gratis de esta aplicación que permitiera mostrar ubicaciones marcadas en un mapa generado por Google enganchado a un iframe en el sistema, con tan solo especificar medidas latitud y longitud, que tuvieron que ser agregadas luego a la tabla ubicación.

	Para integrar la visualización de mapas usando la aplicación Google maps de manera gratuita para la empresa, el usuario debía ingresar los valores de latitud y longitud de la ubicación deseada. Para esto el pasante ofreció como solución analizar gramaticalmente la URL mostrada en la aplicación web google maps por medio de expresiones regulares para extraer los valores necesarios, facilitando así al usuario el proceso de agregar una ubicación sin que la empresa tuviera que usar las funcionalidades pagas de google.

	% section ubicaciones (end)

	\section{Cursos del tipo Seminario} % (fold)
	\label{sec:cursos_del_tipo_seminario}
	
	Luego de examinar las tablas y entender el funcionamiento de los cursos y como son asignados a los grupos (Anexo \ref{fig:baseDeDatosPrevia}) se decidió extender esta tabla como una generalización.

	El sistema solo daba soporte a cursos del tipo multimedia dentro del mismo sistema, que podían ser de autoría del cliente o externos. Estos dos tipos eran manejados con un booleano ``cursoDeAutoria'' decisión de diseño que no daba espacio para la expansión de más tipos de cursos. El pasante sugirió agregar un campo ``tipo'' a la tabla de Curso asignándole el entero \emph{2} al tipo de curso seminario. dejando los enteros \emph{0} y \emph{1} a los anteriores tipos de cursos. La migración de los tipos anteriores para ser representados con el nuevo campo ``tipo'' fue sugerida pero los demás desarrolladores rechazaron la propuesta por provocar cambios en otras funcionalidades del sistema. el estado final de la base de datos se demuestra en el anexo \ref{fig:baseDeDatosFinal}.

	Una vez diferenciado el nuevo tipo curso de los demás en la aplicación se procedió a dar soporte a las actividades CRUD para los seminarios. para esto se reutilizó la sección del sistema usada para la creación de cursos. Agregando la opción \emph{seminario} a las opciones previas en la creación de un curso y cambiando la estructura de la forma HTML usando Javascript, así como los datos enviados mediante el método POST y su respectiva validación en el servidor para el soporte de los seminarios. La vista se incluyó en el anexo \ref{fig:creacionSeminario}.

	Una de las diferencias de los seminarios con los cursos multimedia es la forma en la que son aprobados, se decidió que podían existir dos tipos:

	\begin{itemize}
		\item Aprobar con tan solo asistir al curso.
		\item Aprobar asistiendo al curso y aprobando un examen presencial.
	\end{itemize}

	Para el soporte de estos dos tipos se agregó un campo ``con\_examen'' que permite la representación.

	El pasante aprovechó los métodos de eliminación, listado y asignación a grupos que el sistema ya poseía, ajustándolos para el funcionamiento con los seminarios. 

	Para lograr esto debió separar visualmente los distintos tipos de cursos en las vistas de listado, para esto agrego un icono que los diferenciara en la vista de cursos del administrador (anexo \ref{fig:listarCursos}). Además, agregó un filtro persistente en la sesión HTTP que permitiera al administrador la visualización de solo cursos del tipo seminario a lo largo de su conexión.

	En el método asignación se agregó luego un \emph{preview} con las sesiones disponibles para el seminario visibles en el apéndice \ref{fig:asignarSeminario} además del icono para los seminarios. 

	% section cursos_del_tipo_seminario (end)

	\section{Usuario instructor} % (fold)
	\label{sec:usuario_instructor}
	
	Para el manejo de la puntuación de las sesiones y el manejo de la asistencia se decidió crear un nuevo tipo de usuario en el sistema que puediera apoyar al administrador en estas tareas. el usuario administrador tiene acceso a todas las funciones de un instructor en todos los cursos del sistema, mientras que el usuario solo tiene acceso a las sesiones en la que él mismo es él instructor.

	Para esto se debió modificar el módulo de \emph{login} para agregar la autentificación del nuevo usuario, que primero confirma si el usuario tiene una jerarquía más alta que la de instructor (un usuario de más rango que contenga sus funciones), en caso contrario, verifica si el usuario que intenta ingresar es instructor de algún curso.

	El manejo de la autorización es realizado de forma manual, así que solo se debió poblar una estructura del tipo diccionario con las funcionalidades que se consideraran necesarias para el usuario instructor. En este caso, administrar los cursos de los que es instructor, funcionalidad desarrollada en el \emph{sprint} cinco.
	
	% section usuario_instructor (end)

	\section{Sesiones de un seminario} % (fold)
	\label{sec:sesiones_de_un_seminario}
	
	Para soportar la funcionalidad en la base de datos se creó la tabla llamada Sesión que contiene todos los datos relevantes para la descripción de una sesión. Es importante recalcar que las sesiones sólo tienen sentido si forman parte de un curso del tipo seminario, cosa que se evidencia en la relación de agrupación en el modelo final de la base de datos en el anexo \ref{fig:baseDeDatosFinal}. 

	Un seminario puede estar compuesto por muchas sesiones, mientras que las sesiones no pueden ser compartidas entre los distintos seminarios, por lo que se representa como una relación 1 a muchos. 

	Una sesión se lleva a cabo en una ubicación por lo que se relacionan estas dos tablas. Una sesión puede suceder en solo una ubicación y las ubicaciones pueden albergar una cantidad de sesiones, por lo que la relación se modelo como 1 a muchos.

	Una sesión además es dictada/supervisada por un instructor por lo que se modelo como una relación 1 a muchos análoga a las demás.

	La última relación es la más interesante, las sesiones se relacionan directamente con los usuarios que asisten a ella (aprendices) y cada uno debe tener un espacio en la base de datos para modelar el resultado que este obtuvo en la misma. es una segunda relación de la tabla sesiones con la tabla Usuario que en este caso es muchos a muchos pues un usuario puede participar en cualquier número de sesiones que le hayan sido asignadas, mientras que a una sesión concurren la cantidad de usuarios que su capacidad permita. Se modelo con una tabla auxiliar que posee las dos foráneas y toda la información que la relación \emph{sesión-usuario} necesitó al momento del desarrollo y la que pueda necesitar en el futuro, haciendo el diseño flexible, una de las metas del proyecto.

	Se procedió a integrar el módulo con las ubicaciones. Para poder crear una sesión debía estar creada en primer lugar una ubicación, por lo tanto, se integró una entrada al módulo de ubicaciones desde el CRUD de la sesión que mantuviera en forma de \emph{cookie} cual sesión estaba siendo modificada para volver a ella. La capacidad de la sesión no podrá ser mayor a la capacidad de la locación seleccionada.

	Además, una sesión no podría ser creada en una fecha en la que la ubicación seleccionada estuviera ocupada (tuviera otra sesión cuyo horario choque). Esta limitación dio pie a que se implementara una visualización de las sesiones activas de una ubicación.

	Para el campo de instructor podía ser seleccionado cualquier usuario activo del sistema del cliente en el que se esté realizando la operación. El cliente puede obtenerse por medio de la tabla curso, así que por normalización no se agregó información del cliente a la sesión como si se agregó a la ubicación.

	Se agregaron campos que limitaban las confirmaciones y la cancelación de una sesión por parte de los aprendices, con el fin de dar seguridad al instructor de la cantidad asistentes a un curso.

	Las sesiones tienen un campo ``activa'' para que puedan ser desactivadas en caso de cualquier eventualidad manteniendo los datos de la sesión para poder así ser reusados.

	Las fechas de inicio y final de una sesión no pueden ser cambiadas si ya poseen usuarios confirmados, por lo que primero tendrían que ser eliminados y notificados de la misma para poder realizar los cambios.

	El borrado de una sesión se puede realizar desde el listado de las sesiones en el administrador como se muestra en las opciones del anexo \ref{fig:listarSesiones}. El usuario instructor no puede borrar la sesión, solo desactivarla.

	Para la visualización se usó un \emph{plug-in} de calendario bootstrap-year-calendar creado usando \emph{bootstrap} y \emph{jquery}. \emph{Plug-in} que permite la representación de los meses en distintos lenguajes, así como la personalización de sus colores, aspectos necesarios para el amplio rango de necesidades de los clientes de FKC.

	Este calendario se llena con AJAX a través de un \emph{endpoint} creado para tal fin que devuelve las sesiones activas de la locación como un objeto json que luego se muestra en los días del calendario como se muestra en el anexo \ref{fig:editarUbicaciones}. las sesiones desactivadas se muestran con un tipo de letra más pequeño y en cursiva para diferenciarlas de las demás.
	% section sesiones_de_un_seminario (end)

	\section{Interfaz para el usuario aprendiz} % (fold)
	\label{sec:interfaz_para_el_usuario_aprendiz}
	
	El reto más importante de esta etapa del proyecto fue encontrar donde mostrar las sesiones de los cursos, si crear otra pestaña en el menu del sistema solo para los cursos del tipo seminario o integrar de alguna forma los cursos diferenciándolos de los demás.

	La opción que se tomó fue la segunda. La primera opción agregaba una entrada más a un menu que comenzaba a lucir un poco abarrotado, pero, la segunda opción trajo sus dificultades. Se tuvo que modificar un código escrito de una forma complicada debido al mal uso de la librería de maquetado \emph{Smarty}. La interfaz era una lista rígida de los cursos como se muestra en el anexo \ref{fig:aprendizListarViejo} por lo que se decidió dar una opción para generar una pestaña debajo de cada curso.

	Este nuevo espacio generado debajo de los seminarios permitió colocar las sesiones disponibles del usuario, pero termino siendo un poco inconsistente que unos cursos tuvieran la opción de generar pestañas con más información y otros no. Como respuesta a esto los clientes sugirieron que ingresara un nuevo campo a la tabla curso para colocar una imagen que pudiera ser mostrada en todas las pestañas junto con la descripción del curso.

	A simple vista era difícil para el usuario diferenciar los seminarios de los cursos multimedia por lo que se agregó un icono para los seminarios al lado del nombre de cada curso. Una vez visibles los seminarios, se consideró necesario notificar al usuario visualmente que la acción de confirmación de una sesión de seminario era necesaria o que dicha acción ya estaba realizada.

	El pasante acudió al equipo de diseñadores gráficos para la realización de todos los iconos necesarios que mostraran el estado de un seminario, reservado, no reservado, sin sesiones disponibles como se muestra en el anexo \ref{fig:aprendizListarCursos}.

	Para el listado de las sesiones se hizo una consulta que buscaba en la base de datos las sesiones que estaban asignadas a los grupos a los que pertenecía el usuario y en cada caso también recolectaba las sesiones confirmadas del usuario para mostrar más información (anexo \ref{fig:usuarioSesionConfirmada}). Al finalizar el siguiente sprint donde se desarrolló la calificación de la sesión también se consultó por las sesiones aprobadas del usuario para no mostrar las sesiones disponibles.

	Al ser la mayoría de los clientes usuario del servicio de correo \emph{outlook} fue solicitado por los clientes una facilidad para exportar automáticamente al calendario \emph{outlook} del aprendiz. Para lograr esto el pasante investigó sobre la especificación de formatos para la transmisión de eventos a través del protocolo HTTP \emph{iCalendar} usado previamente por la empresa. \emph{iCalendar} es soportado por las plataformas más famosas como \emph{google, apple, microsoft outlook} entre otras. Se creo un pequeño módulo que recibida los datos de una sesión del sistema y producía un archivo en formato ics para ser descargado por el usuario y usado en su aplicación de calendario de preferencia. Con esto se pudo cumplir el requerimiento del cliente y más.
	% section interfaz_para_el_usuario_aprendiz (end)



